<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="../dist/sdk.es5.js"></script>
  <script type="text/javascript" lang="javascript"
          src="http://cdn.gigya.com/js/gigya.js?apikey=3_4dA7nagT-27tI2ZgZ080PZr_ahnMWgoX5Iv2I-PjM7AkT1aEac8zvz2zpj2V2tmX">
    {
      customEventMap : {
        eventMap: [
          {
            events: "afterScreenLoad",
            method: function (e) {
              console.log(e);
            },
            args: [function (e) {
              return e
            }]
          }
        ]
      }
    }
  </script>
  <style>
    .ownid-tooltip-wrapper,
    .ownid-inline-widget {
      z-index: 1000010006;
    }
  </style>
</head>
<body>

<script>
  function onGigyaServiceReady() {
    ownid.init({
      URLPrefix: 'http://localhost:5002/ownid/', // optional. default path is /ownId/
    });
  }

  window.ownIDWidgetStack = [];

  function getOwnIdWrapper() {
    let ownIDElement = document.getElementById('ownid-wrapper');
    if (!ownIDElement) {
      ownIDElement = document.createElement('div');
      ownIDElement.id = 'ownid-wrapper';

      document.body.appendChild(ownIDElement);
    }

    return ownIDElement;
  }

  function renderRegisterWidget() {
    const pass = document.querySelector('[data-gigya-name="password"]');
    const repeatPass = document.querySelector('[data-gigya-name="passwordRetype"]');

    ownIDWidgetStack.push(
      ownid.render({
        type: 'register',
        inline: {
          targetElement: pass,
          additionalElements: [repeatPass],
          offset: [0, -10],
        },
        element: getOwnIdWrapper(),
      })
    );

    // document.getElementsByClassName("gigya-input-submit")[0].addEventListener("click", function(){
    //   var pw = ownid.generateOwnIDPassword(32);
    //   document.querySelectorAll("[data-gigya-name='password']")[0].value = pw;
    //   document.querySelectorAll("[data-gigya-name='passwordRetype']")[0].value = pw;
    // });
  }

  function renderLoginWidget(onLogin) {
    const pass = document.querySelector('[data-gigya-name="password"]');

    ownIDWidgetStack.push(
      ownid.render({
        type: 'login',
        inline: {
          targetElement: pass,
          offset: [0, -10],
        },
        element: getOwnIdWrapper(),
        onLogin,
      })
    );
  }

  function destroyOwnIDWidget() {
    const widget = ownIDWidgetStack.shift();

    if (widget) {
      widget.destroy();
    }
  }

  function loadScreenSet(startScreen) {
    const params = {
      screenSet: 'Default-RegistrationLogin',
      startScreen,
      onError(event) {
        console.log('onError', event);
      },
      onBeforeSubmit(event) {
        console.log('onBeforeSubmit', event);
      },
      onAfterSubmit(event) {
        console.log('onAfterSubmit', event);
      },
      onBeforeScreenLoad(event) {
        console.log('onBeforeScreenLoad', event);
      },
      onBeforeValidation(event) {
        console.log('onBeforeValidation', event);

        // var pw = ownid.generateOwnIDPassword(32);
        // event.formData.password = pw;
        // event.formData.passwordRetype = pw;
        // document.querySelectorAll("[data-gigya-name='password']")[0].value = pw;
        // document.querySelectorAll("[data-gigya-name='passwordRetype']")[0].value = pw;
      },
      onFieldChanged(event) {
        console.log('onFieldChanged', event);

        setTimeout(() => ownIDWidgetStack[0].recalculatePosition());
      },
      onAfterScreenLoad(event) {
        console.log('onAfterScreenLoad', event);

        destroyOwnIDWidget();

        if (event.currentScreen === 'gigya-login-screen') {
          renderLoginWidget(function (e) {
            console.log(e);
          });
        }

        if (event.currentScreen === 'gigya-register-screen') {
          renderRegisterWidget();
        }
      },
      onHide(event) {
        console.log('onHide', event);

        destroyOwnIDWidget()
      },
      onSubmit(event) {
        ownid.getOwnIDPayload(ownIDWidgetStack[0]).then(({data}) => {
            console.log('onSubmit');
            if (!data) {
              return;
            }

            event.formModel.data.ownIdConnections = [{...data}];
          }
        )
      },
    }

    gigya.accounts.showScreenSet(params)
  }


</script>

<a href="#" onclick="loadScreenSet('gigya-login-screen')">Login</a>


<a href="#" onclick="loadScreenSet('gigya-register-screen')">Registration</a>

<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>
<p>sdfdsfdsf</p>

</body>
</html>
